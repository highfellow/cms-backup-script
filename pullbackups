#!/bin/bash
#
# Script to pull down a set of backups generated by 'backup' from a remote
# server.
#

# set some defaults
backupdir=/var/backups

if [ "$1" == "--help" ]; then
    echo "pullbackups"
    echo "pull a set of backups generated by backup script from a remote server"
    exit 1
fi

# work out where I am and find some things.
mydir=`readlink -f $0`
mydir=${mydir%/*}
. $mydir/bash-ini-multisection/ini-parse.sh
confdir=${0%/*}
if [ "$confdir" == "." ]; then
  confdir=`pwd`
fi
if [ "$confdir" == ".." ]; then
  confdir=`pwd`
  confdir=${confdir%/*}
fi
# expecting this script to be in path/bin with config in path/etc
confdir=${confdir%/*}/etc # edit this if your global config is somewhere else.

# set some defaults.
nightlyfiles=8
weeklyday=Tue
weeklyfiles=5
monthlyday=01
monthlyfiles=3

# parse the global configuration 
cfg_parser $confdir/pullbackups.ini
cfg_section global
eval backupdir=$backupdir
if [ "$rsyncsrc" == "" ] ; then
  echo "Rsync source string not found in $confdir/pullbackups.ini"
  exit 1
fi

echo "Pulling down backups from $rsyncsrc"

cd $backupdir
rsync -av $rsyncsrc .
for config in *; do
done
